import{e as $}from"./index.modern.CkIAsQri.js";function w(){return w=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)({}).hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},w.apply(null,arguments)}function A(r){return r.localName!=="title"&&!r.matches("[data-swup-theme]")}function P(r,n){return r.outerHTML===n.outerHTML}function x(r,n=[]){const t=Array.from(r.attributes);return n.length?t.filter(({name:i})=>n.some(m=>m instanceof RegExp?m.test(i):i===m)):t}function j(r){return r.matches("link[rel=stylesheet][href]")}class B extends ${constructor(n={}){var t;super(),t=this,this.name="SwupHeadPlugin",this.requires={swup:">=4.6"},this.defaults={persistTags:!1,persistAssets:!1,awaitAssets:!1,attributes:["lang","dir"],timeout:3e3},this.options=void 0,this.updateHead=async function(i,{page:{}}){const{awaitAssets:m,attributes:y,timeout:H}=t.options,T=i.to.document,{removed:E,added:b}=function(s,f,{shouldPersist:c=()=>!1}={}){const a=Array.from(s.children),o=Array.from(f.children),d=(h=a,o.reduce((e,l,g)=>(h.some(v=>P(l,v))||e.push({el:l,index:g}),e),[]));var h;const p=function(e,l){return e.reduce((g,v)=>(l.some(O=>P(v,O))||g.push({el:v}),g),[])}(a,o);p.reverse().filter(({el:e})=>A(e)).filter(({el:e})=>!c(e)).forEach(({el:e})=>s.removeChild(e));const u=d.filter(({el:e})=>A(e)).map(e=>{let l=e.el.cloneNode(!0);return s.insertBefore(l,s.children[(e.index||0)+1]||null),w({},e,{el:l})});return{removed:p.map(({el:e})=>e),added:u.map(({el:e})=>e)}}(document.head,T.head,{shouldPersist:s=>t.isPersistentTag(s)});if(t.swup.log(`Removed ${E.length} / added ${b.length} tags in head`),y!=null&&y.length&&function(s,f,c=[]){const a=new Set;for(const{name:o,value:d}of x(f,c))s.setAttribute(o,d),a.add(o);for(const{name:o}of x(s,c))a.has(o)||s.removeAttribute(o)}(document.documentElement,T.documentElement,y),m){const s=function(f,c=0){return f.filter(j).map(a=>function(o,d=0){let h;const p=u=>{o.sheet?u():h=setTimeout(()=>p(u),10)};return new Promise(u=>{p(()=>u(o)),d>0&&setTimeout(()=>{h&&clearTimeout(h),u(o)},d)})}(a,c))}(b,H);s.length&&(t.swup.log(`Waiting for ${s.length} assets to load`),await Promise.all(s))}},this.options=w({},this.defaults,n),this.options.persistAssets&&!this.options.persistTags&&(this.options.persistTags="link[rel=stylesheet], script[src], style")}mount(){this.before("content:replace",this.updateHead)}isPersistentTag(n){const{persistTags:t}=this.options;return typeof t=="function"?t(n):typeof t=="string"&&t.length>0?n.matches(t):!!t}}export{B as default};
